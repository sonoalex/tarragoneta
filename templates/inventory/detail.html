{% extends "base.html" %}

{% block title %}{{ get_inventory_category_name(item.category) }} - {{ get_inventory_subcategory_name(item.subcategory) }} - Tarracograf{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
<style>
    #map { height: 400px; border-radius: 16px; z-index: 0; }
</style>
{% endblock %}

{% block content %}
<!-- Hero Section with Image and Title -->
<section class="py-0" style="background: var(--bg-cream); padding-top: 110px !important;" id="hero-section">
    <div class="container-fluid px-0">
        <div class="row g-0">
            <!-- Image Column -->
            <div class="col-lg-7">
                {% if item.image_path %}
                    {% set image_url = get_image_url(item.image_path, 'large') %}
                    {% if image_url %}
                        <img src="{{ image_url }}" 
                             alt="{{ get_inventory_category_name(item.category) }}" 
                             class="w-100" 
                             style="object-fit: cover; height: 500px;">
                    {% else %}
                        <div class="w-100 d-flex align-items-center justify-content-center" style="height: 500px; background: var(--bg-light);">
                            <i class="fas fa-image" style="font-size: 4rem; color: var(--text-muted);"></i>
                        </div>
                    {% endif %}
                {% else %}
                    <div class="w-100 d-flex align-items-center justify-content-center" style="height: 500px; background: var(--bg-light);">
                        <i class="fas fa-image" style="font-size: 4rem; color: var(--text-muted);"></i>
                    </div>
                {% endif %}
            </div>
            
            <!-- Title Column -->
            <div class="col-lg-5 d-flex align-items-center" style="background: var(--bg-white);">
                <div class="p-5 w-100">
                    <span class="badge bg-primary px-3 py-2 mb-3" style="border-radius: 50px; font-weight: 600;">
                        {{ get_inventory_category_name(item.category) }}
                    </span>
                    <h1 class="display-5 fw-bold mb-4" style="line-height: 1.2;">
                        {{ get_inventory_subcategory_name(item.subcategory) }}
                    </h1>
                    
                    <div class="d-flex flex-column gap-3">
                        <div class="d-flex align-items-center">
                            <div class="me-3" style="width: 40px; height: 40px; background: var(--primary-green-pale); border-radius: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                                <i class="fas fa-map-marker-alt" style="color: var(--primary-green);"></i>
                            </div>
                            <div>
                                <div class="small text-muted">{{ _('UbicaciÃ³') }}</div>
                                <div class="fw-bold">{{ item.address or _('Coordenades') }}: {{ "%.6f"|format(item.latitude) }}, {{ "%.6f"|format(item.longitude) }}</div>
                            </div>
                        </div>
                        <div class="d-flex align-items-center">
                            <div class="me-3" style="width: 40px; height: 40px; background: var(--primary-green-pale); border-radius: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                                <i class="fas fa-calendar" style="color: var(--primary-green);"></i>
                            </div>
                            <div>
                                <div class="small text-muted">{{ _('Reportat el') }}</div>
                                <div class="fw-bold">{{ item.created_at.strftime('%d/%m/%Y') }} Â· {{ item.created_at.strftime('%H:%M') }}</div>
                            </div>
                        </div>
                        {% if item.section %}
                        <div class="d-flex align-items-center">
                            <div class="me-3" style="width: 40px; height: 40px; background: var(--primary-green-pale); border-radius: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                                <i class="fas fa-map" style="color: var(--primary-green);"></i>
                            </div>
                            <div>
                                <div class="small text-muted">{{ _('SecciÃ³') }}</div>
                                <div class="fw-bold">{{ item.section.name }} ({{ item.section.full_code }})</div>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                    
                    <!-- Stats -->
                    <div class="mt-4 pt-4 border-top">
                        <div class="row g-3">
                            <div class="col-4">
                                <div class="text-center p-3" style="background: var(--bg-light); border-radius: 12px;">
                                    <div class="h4 mb-0 text-warning" id="importance-count">
                                        <i class="fas fa-star"></i> <span>{{ item.importance_count }}</span>
                                    </div>
                                    <div class="small text-muted">{{ _('confirmacions') }}</div>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="text-center p-3" style="background: var(--bg-light); border-radius: 12px;">
                                    <div class="h4 mb-0 text-danger" id="resolved-count">
                                        <i class="fas fa-times-circle"></i> <span>{{ item.resolved_count }}</span>
                                    </div>
                                    <div class="small text-muted">{{ _('ja no hi Ã©s') }}</div>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="text-center p-3" style="background: var(--bg-light); border-radius: 12px;">
                                    <div class="h4 mb-0 text-info" id="share-count">
                                        <i class="fas fa-share-alt"></i> <span>{{ item.share_count or 0 }}</span>
                                    </div>
                                    <div class="small text-muted">{{ _('comparticions') }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Share Button -->
                    <div class="mt-4">
                        <button class="btn btn-outline-primary w-100" id="share-btn" 
                                data-url="{{ url_for('inventory.item_detail', item_id=item.id, _external=True) }}"
                                data-title="{{ get_inventory_category_name(item.category) }} - {{ get_inventory_subcategory_name(item.subcategory) }}">
                            <i class="fas fa-share-alt me-2"></i>{{ _('Compartir') }}
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Main Content -->
<section class="py-5" style="background: var(--bg-cream);">
    <div class="container">
        <div class="row">
            <!-- Left Column: Main Content -->
            <div class="col-lg-8 mb-5 mb-lg-0">
                <!-- Map Section -->
                <div class="card border-0 shadow-sm mb-4" style="border-radius: 16px; overflow: hidden;">
                    <div class="card-body p-0">
                        <div class="p-4 border-bottom">
                            <h3 class="h5 fw-bold mb-0">{{ _('UbicaciÃ³') }}</h3>
                            <p class="text-muted small mb-0">{{ item.address or _('Coordenades') }}: {{ "%.6f"|format(item.latitude) }}, {{ "%.6f"|format(item.longitude) }}</p>
                        </div>
                        <div id="map"></div>
                    </div>
                </div>

                <!-- Description -->
                {% if item.description %}
                <div class="card border-0 shadow-sm mb-4" style="border-radius: 16px;">
                    <div class="card-body p-4">
                        <h2 class="h4 fw-bold mb-4">{{ _('DescripciÃ³') }}</h2>
                        <div style="line-height: 1.8; color: var(--text-medium);">
                            {{ item.description|safe }}
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Actions -->
                {% if current_user.is_authenticated %}
                <div class="card border-0 shadow-sm mb-4" style="border-radius: 16px;">
                    <div class="card-body p-4">
                        <h3 class="h5 fw-bold mb-4">{{ _('Accions') }}</h3>
                        <div class="d-flex gap-2">
                            {% if has_voted %}
                                <button class="btn btn-primary flex-fill" disabled id="vote-btn">
                                    <i class="fas fa-plus me-1"></i>+1 {{ _('(Ja has confirmat)') }}
                                </button>
                            {% else %}
                                <button class="btn btn-primary flex-fill" id="vote-btn" data-item-id="{{ item.id }}">
                                    <i class="fas fa-plus me-1"></i>+1
                                </button>
                            {% endif %}
                            
                            {% if has_resolved %}
                                <button class="btn btn-warning flex-fill" disabled id="resolve-btn">
                                    <i class="fas fa-times-circle me-1"></i>{{ _('Ja no hi Ã©s') }} {{ _('(Ja has reportat)') }}
                                </button>
                            {% else %}
                                <button class="btn btn-warning flex-fill" id="resolve-btn" data-item-id="{{ item.id }}">
                                    <i class="fas fa-times-circle me-1"></i>{{ _('Ja no hi Ã©s') }}
                                </button>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
            
            <!-- Right Column: Sidebar -->
            <div class="col-lg-4">
                <!-- Reporter Info -->
                {% if item.reporter %}
                <div class="card border-0 shadow-sm mb-4" style="border-radius: 16px;">
                    <div class="card-body p-4">
                        <div class="d-flex align-items-center">
                            <div class="me-3" style="width: 50px; height: 50px; background: var(--primary-green); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 1.2rem; flex-shrink: 0;">
                                {{ item.reporter.username[0]|upper }}
                            </div>
                            <div>
                                <div class="small text-muted">{{ _('Reportat per') }}</div>
                                <div class="fw-bold">{{ item.reporter.username }}</div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
                
                <!-- Status Badge -->
                <div class="card border-0 shadow-sm mb-4" style="border-radius: 16px;">
                    <div class="card-body p-4">
                        <div class="small text-muted mb-2">{{ _('Estat') }}</div>
                        {% if item.status == 'approved' %}
                            <span class="badge bg-success px-3 py-2" style="font-size: 0.9rem;">{{ _('Aprovat') }}</span>
                        {% elif item.status == 'pending' %}
                            <span class="badge bg-warning px-3 py-2" style="font-size: 0.9rem;">{{ _('Pendent') }}</span>
                        {% elif item.status == 'resolved' %}
                            <span class="badge bg-secondary px-3 py-2" style="font-size: 0.9rem;">{{ _('Resolt') }}</span>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
<script>
    // Initialize map
    var map = L.map('map').setView([{{ item.latitude }}, {{ item.longitude }}], 16);
    
    // Add tile layer
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Â© OpenStreetMap contributors'
    }).addTo(map);
    
    // Add marker
    var marker = L.marker([{{ item.latitude }}, {{ item.longitude }}]).addTo(map);
    marker.bindPopup('<strong>{{ get_inventory_category_name(item.category) }}</strong><br>{{ item.address or _("Coordenades") }}');
    
    // Vote button handler
    document.getElementById('vote-btn')?.addEventListener('click', function(e) {
        e.preventDefault();
        var btn = this;
        var itemId = btn.getAttribute('data-item-id');
        if (!itemId || btn.disabled) return;
        
        btn.disabled = true;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>{{ _("Processant...") }}';
        
        var csrfToken = document.querySelector('meta[name="csrf-token"]')?.content || 
                       document.querySelector('input[name="csrf_token"]')?.value || 
                       '{{ csrf_token() }}';
        
        fetch(`{{ url_for('inventory.vote_item', item_id=0) }}`.replace('0', itemId), {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: `csrf_token=${encodeURIComponent(csrfToken)}`
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Update importance count
                var countSpan = document.querySelector('#importance-count span');
                if (countSpan) {
                    countSpan.textContent = data.importance_count;
                }
                
                // Update button state
                btn.disabled = true;
                btn.innerHTML = '<i class="fas fa-plus me-1"></i>+1 {{ _("(Ja has confirmat)") }}';
                
                // Show success message
                var alertDiv = document.createElement('div');
                alertDiv.className = 'alert alert-success alert-dismissible fade show mt-2';
                alertDiv.innerHTML = `
                    ${data.message || '{{ _("Vot registrat correctament") }}'}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                `;
                btn.parentElement.parentElement.appendChild(alertDiv);
            } else {
                throw new Error(data.error || '{{ _("Error al votar") }}');
            }
        })
        .catch(error => {
            console.error('Error voting:', error);
            btn.disabled = false;
            btn.innerHTML = '<i class="fas fa-plus me-1"></i>+1';
            
            var alertDiv = document.createElement('div');
            alertDiv.className = 'alert alert-danger alert-dismissible fade show mt-2';
            alertDiv.innerHTML = `
                ${error.message || '{{ _("Error al votar. Torna-ho a intentar.") }}'}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            btn.parentElement.parentElement.appendChild(alertDiv);
        });
    });
    
    // Resolve button handler
    document.getElementById('resolve-btn')?.addEventListener('click', function(e) {
        e.preventDefault();
        var btn = this;
        var itemId = btn.getAttribute('data-item-id');
        if (!itemId || btn.disabled) return;
        
        btn.disabled = true;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>{{ _("Processant...") }}';
        
        var csrfToken = document.querySelector('meta[name="csrf-token"]')?.content || 
                       document.querySelector('input[name="csrf_token"]')?.value || 
                       '{{ csrf_token() }}';
        
        fetch(`{{ url_for('inventory.resolve_item', item_id=0) }}`.replace('0', itemId), {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: `csrf_token=${encodeURIComponent(csrfToken)}`
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Update resolved count
                var countSpan = document.querySelector('#resolved-count span');
                if (countSpan) {
                    countSpan.textContent = data.resolved_count;
                }
                
                // Update button state
                btn.disabled = true;
                btn.innerHTML = '<i class="fas fa-times-circle me-1"></i>{{ _("Ja no hi Ã©s") }} {{ _("(Ja has reportat)") }}';
                
                // Show success message
                var alertDiv = document.createElement('div');
                alertDiv.className = 'alert alert-success alert-dismissible fade show mt-2';
                alertDiv.innerHTML = `
                    ${data.message || '{{ _("Report registrat correctament") }}'}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                `;
                btn.parentElement.parentElement.appendChild(alertDiv);
            } else {
                throw new Error(data.error || '{{ _("Error al reportar") }}');
            }
        })
        .catch(error => {
            console.error('Error resolving:', error);
            btn.disabled = false;
            btn.innerHTML = '<i class="fas fa-times-circle me-1"></i>{{ _("Ja no hi Ã©s") }}';
            
            var alertDiv = document.createElement('div');
            alertDiv.className = 'alert alert-danger alert-dismissible fade show mt-2';
            alertDiv.innerHTML = `
                ${error.message || '{{ _("Error al reportar. Torna-ho a intentar.") }}'}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            btn.parentElement.parentElement.appendChild(alertDiv);
        });
    });
    
    // Share button handler
    document.getElementById('share-btn')?.addEventListener('click', function(e) {
        e.preventDefault();
        var btn = this;
        var url = btn.getAttribute('data-url');
        var title = btn.getAttribute('data-title');
        var itemId = {{ item.id }};
        
        shareItem(url, title, itemId);
    });
    
    // Share function - always show modal (no native share)
    function shareItem(url, title, itemId) {
        openShareModal(url, title, itemId);
    }
    
    // Function to increment share count
    function incrementShareCount(itemId) {
        console.log('Incrementing share count for item:', itemId);
        if (!itemId) {
            console.error('No itemId provided');
            return;
        }
        fetch(`/inventory/api/items/${itemId}/share`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => {
            console.log('Response status:', response.status);
            return response.json();
        })
        .then(data => {
            console.log('Share count response:', data);
            if (data.success) {
                var shareCountSpan = document.querySelector('#share-count span');
                if (shareCountSpan) {
                    shareCountSpan.textContent = data.share_count;
                } else {
                    console.warn('Share count span not found');
                }
            }
        })
        .catch(error => {
            console.error('Error incrementing share count:', error);
        });
    }
    
    // Open share modal
    function openShareModal(url, title, itemId) {
        // Create a temporary element with share modal
        var shareDiv = document.createElement('div');
        var shareText = title + ' ' + url;
        shareDiv.innerHTML = `
            <div class="modal fade" id="shareModal" tabindex="-1">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">{{ _('Compartir') }}</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body text-center">
                            <p class="mb-3">{{ _('Comparteix aquest item a les xarxes socials') }}</p>
                            <div class="d-flex justify-content-center gap-3">
                                <a href="https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}" 
                                   target="_blank" 
                                   class="btn btn-lg rounded-circle d-flex align-items-center justify-content-center share-facebook-btn" 
                                   data-item-id="${itemId}"
                                   style="width: 50px; height: 50px; background-color: #1877F2; border: none; padding: 0;">
                                    <svg width="24" height="24" fill="white" viewBox="0 0 24 24">
                                        <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                                    </svg>
                                </a>
                                <a href="https://twitter.com/intent/tweet?url=${encodeURIComponent(url)}&text=${encodeURIComponent(title)}" 
                                   target="_blank" 
                                   class="btn btn-lg rounded-circle d-flex align-items-center justify-content-center share-twitter-btn" 
                                   data-item-id="${itemId}"
                                   style="width: 50px; height: 50px; background-color: #1DA1F2; border: none; padding: 0;">
                                    <svg width="24" height="24" fill="white" viewBox="0 0 24 24">
                                        <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
                                    </svg>
                                </a>
                                <a href="https://wa.me/?text=${encodeURIComponent('Â¡Epp! Â¡Mira quÃ¨ hi ha aquÃ­! ðŸ“¸\n\n' + title + '\n\n' + url)}" 
                                   target="_blank" 
                                   class="btn btn-lg rounded-circle d-flex align-items-center justify-content-center share-whatsapp-btn" 
                                   data-item-id="${itemId}"
                                   style="width: 50px; height: 50px; background-color: #25D366; border: none; padding: 0;">
                                    <svg width="24" height="24" fill="white" viewBox="0 0 24 24">
                                        <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
                                    </svg>
                                </a>
                                <button id="share-link-btn" 
                                        class="btn btn-secondary btn-lg rounded-circle d-flex align-items-center justify-content-center" 
                                        data-item-id="${itemId}"
                                        style="width: 50px; height: 50px; padding: 0;">
                                    <svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                                        <path d="M4.715 6.542 3.343 7.914a3.201 3.201 0 0 0 4.486 4.486l1.828-1.829a3.2 3.2 0 0 0 0-4.486l-1.829-1.828-1.414 1.414z"/>
                                        <path d="M6.586 4.672V3.39a1.5 1.5 0 0 1 1.5-1.5h5.976a1.5 1.5 0 0 1 1.5 1.5v5.976a1.5 1.5 0 0 1-1.5 1.5h-2.282l-1.414-1.414h2.282V3.39H8.086v1.282H6.586z"/>
                                        <path d="M11.314 4.672V3.39a1.5 1.5 0 0 0-1.5-1.5H3.928a1.5 1.5 0 0 0-1.5 1.5v5.976a1.5 1.5 0 0 0 1.5 1.5h2.282v1.282H3.928a2.5 2.5 0 0 1-2.5-2.5V3.39a2.5 2.5 0 0 1 2.5-2.5h5.886a2.5 2.5 0 0 1 2.5 2.5v1.282z"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
        document.body.appendChild(shareDiv);
        
        // Wait for modal to be in DOM before adding event listeners
        setTimeout(function() {
            var modalItemId = itemId;
            console.log('Setting up share buttons for item:', modalItemId);
            var shareButtons = document.querySelectorAll('.share-facebook-btn, .share-twitter-btn, .share-whatsapp-btn');
            console.log('Found share buttons:', shareButtons.length);
            shareButtons.forEach(function(btn) {
                btn.addEventListener('click', function(e) {
                    console.log('Share button clicked, itemId:', modalItemId);
                    incrementShareCount(modalItemId);
                });
            });
            
            var linkBtn = document.getElementById('share-link-btn');
            if (linkBtn) {
                linkBtn.addEventListener('click', function() {
                    navigator.clipboard.writeText(url).then(function() {
                        incrementShareCount(modalItemId);
                        showToast('EnllaÃ§ copiat! ðŸ”—', 'URL copiada al portapapers', 'success');
                        document.getElementById('shareModal').querySelector('[data-bs-dismiss]').click();
                    });
                });
            }
        }, 100);
        
        // Toast function
        function showToast(title, message, type) {
            var toastDiv = document.createElement('div');
            toastDiv.className = 'toast align-items-center text-white bg-' + (type === 'success' ? 'success' : 'info') + ' border-0';
            toastDiv.setAttribute('role', 'alert');
            toastDiv.setAttribute('aria-live', 'assertive');
            toastDiv.setAttribute('aria-atomic', 'true');
            toastDiv.style.position = 'fixed';
            toastDiv.style.top = '20px';
            toastDiv.style.right = '20px';
            toastDiv.style.zIndex = '9999';
            toastDiv.innerHTML = `
                <div class="d-flex">
                    <div class="toast-body">
                        <strong>${title}</strong><br>
                        ${message}
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                </div>
            `;
            document.body.appendChild(toastDiv);
            var toast = new bootstrap.Toast(toastDiv, { delay: 3000 });
            toast.show();
            toastDiv.addEventListener('hidden.bs.toast', function() {
                toastDiv.remove();
            });
        }
        
        var shareModal = new bootstrap.Modal(document.getElementById('shareModal'));
        shareModal.show();
        // Remove modal from DOM after it's hidden
        document.getElementById('shareModal').addEventListener('hidden.bs.modal', function() {
            shareDiv.remove();
        });
    }
</script>
{% endblock %}

